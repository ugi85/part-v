<!DOCTYPE html>
<html lang="en">
<head>
    <head>
    <meta charset="utf-8">
    <title>BiCoder</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="Responsive bootstrap 4 admin template" name="description">
    <meta content="Coderthemes" name="author">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- App favicon -->
    <link rel="shortcut icon" href="assets/images/favicon.ico">

    <!-- Plugins css-->
    <link href="assets/libs/sweetalert2/sweetalert2.min.css" rel="stylesheet" type="text/css">

    <!-- App css -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" id="bootstrap-stylesheet">
    <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css">
    <link href="assets/css/app.min.css" rel="stylesheet" type="text/css" id="app-stylesheet">

     <!-- third party css -->
     <link href="assets/libs/datatables/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">
     <link href="assets/libs/datatables/buttons.bootstrap4.min.css" rel="stylesheet" type="text/css">
     <link href="assets/libs/datatables/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css">
     <link href="assets/libs/datatables/select.bootstrap4.min.css" rel="stylesheet" type="text/css">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laporan Data Parts</title>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


<script>
    document.addEventListener('DOMContentLoaded', function() {
        if (!sessionStorage.getItem('isLoggedIn')) {
            window.location.href = 'index.html';
        }
    });
</script>

<div id="loadingSpinner" style="display: none;">
    <style>
        #loadingSpinner {
            margin: 20px 0;
        }

        .spinner-border {
            width: 3rem;
            height: 3rem;
            border-width: .4em;
            color: rgb(47, 47, 230);
        }
    </style>
</div>

</head>
<body>
    <!-- Begin page -->
    <div id="wrapper">
        <!-- Topbar Start -->
        <div class="navbar-custom">
            <ul class="list-unstyled topnav-menu float-right mb-0">
                <li class="dropdown notification-list">
                    <a class="nav-link dropdown-toggle nav-user mr-0 waves-effect" data-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
                        <img src="assets/images/users/avatar-1.jpg" alt="user-image" class="rounded-circle">
                        <span class="pro-user-name ml-1">
                        <span id="tampil_nama1"></span>
                            <i class="mdi mdi-chevron-down"></i>
                        </span>

                    </a>
                    <div class="dropdown-menu dropdown-menu-right profile-dropdown">
                        <div class="dropdown-header noti-title">
                            <h6 class="text-overflow m-0">Welcome !</h6>
                        </div>
                        <a href="javascript:void(0);" class="dropdown-item notify-item">
                            <i class="mdi mdi-account-outline"></i>
                            <span>Profile</span>
                        </a>
                       
                        <div class="dropdown-divider"></div>
                        <a href="javascript:void(0);" id="logoutButton" class="dropdown-item notify-item">
                            <i class="mdi mdi-logout-variant"></i>
                            <span>Logout</span>
                        </a>
                    </div>
                </li>
            </ul>
            <div class="logo-box">
                <a href="main.html" class="logo text-center ">
                    <span class="logo-lg">
                        <img src="assets/images/logo-dark1.png" alt="" height="30">
                        <!-- <span class="logo-lg-text-dark">Velonic</span> -->
                    </span>
                    <span class="logo-sm">
                        <!-- <span class="logo-lg-text-dark">V</span> -->
                        <img src="assets/images/logo-smb.png" alt="" height="22">
                    </span>
                </a>

            </div>

            <ul class="list-unstyled topnav-menu topnav-menu-left m-0">
                <li>
                    <button class="button-menu-mobile waves-effect">
                        <i class="mdi mdi-menu"></i>
                    </button>
                </li>
            </ul>
        </div>
        <!-- end Topbar -->

        <!-- Left Sidebar Start -->
        <div class="left-side-menu">
            <div class="slimscroll-menu">
                <div id="sidebar-menu">
                    <ul class="metismenu" id="side-menu">
                        <li id="menu-data-users">
                            <a href="data-users.html">
                                <i class="ion ion-ios-contacts"></i>
                                <span> Data Users </span>
                            </a>
                        </li>
                        <li>
                            <a href="data-part.html">
                                <i class="ion ion-ios-construct"></i>
                                <span> Data Parts </span>
                            </a>
                        </li>
                        <li>
                            <a href="add-stock.html">
                                <i class="ion ion-md-cube"></i>
                                <span> Penambahan Stock </span>
                            </a>
                        </li>
                        <li>
                            <a href="get-barang.html">
                                <i class="ion ion-ios-basket"></i>
                                <span> Pengambilan Barang </span>
                            </a>
                        </li>

                        <li>
                            <a href="javascript: void(0);" class="waves-effect">
                                <i class="mdi mdi-share-variant"></i>
                                <span> Report </span>
                                <span class="menu-arrow"></span>
                            </a>
                            <ul class="nav-second-level nav" aria-expanded="false">
                                <li>
                                    <a href="Laporan-DP.html">Data Parts</a>
                                </li>
                                <li>
                                    <a href="javascript: void(0);" aria-expanded="false">Data Pengambilan Barang</a>
                                         
                                    </ul>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
                <div class="clearfix"></div>
            </div>
        </div>
    </div>

        <!-- Left Sidebar End -->



    <h2>Laporan Data Parts</h2>
    
   

    

    <!-- Filter Form -->
    <div class="form-group">
        <label for="filterColumn">Filter Berdasarkan Kolom:</label>
        <select id="filterColumn" class="form-control">

            <!-- <option value="">--Pilih--</option> -->
            <option value="id_part">ID Part</option>
            <option value="description">Description</option>
            <option value="specification">Specification</option>
            <option value="location">Location</option>
            <!-- Tambahkan kolom lainnya -->
        </select>

        <label for="filterValue">Nilai Filter:</label>
        <input type="text" id="filterValue" class="form-control" placeholder="Masukkan nilai filter">

        <button id="applyFilter" class="btn btn-primary">Terapkan Filter</button>
    </div>

    <!-- Tabel Data -->
    <table id="userTable" class="table table-bordered">
        <thead>
            <tr>
                <th>ID Part</th>
                <th>Description</th>
                <th>Specification</th>
                <th>Machine</th>
                <th>Supplier 1</th>
                <th>Supplier 2</th>
                <th>Location</th>
                <th>Type Part</th>
                <th>Min</th>
                <th>Max</th>
                <th>Unit</th>
                <th>Lead Time (Day)</th>
                <th>Stock</th>
                <th>Price</th>
                <th>Total Value</th>
                <th>Total Sparepart Cost</th>
                <th>Condition</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const scriptURL = 'https://script.google.com/macros/s/AKfycbwwwWDOmSCm8tRABze_aYK7igCbIKAQ_hf4h27rxCF_VOuBQf4c_NMET-wzEqMiJ1gYhg/exec?action=read';
            const loadingSpinner = document.getElementById('loadingSpinner');
            const filterColumn = document.getElementById('filterColumn');
            const filterValue = document.getElementById('filterValue');
            const applyFilterButton = document.getElementById('applyFilter');

            function displayData(users) {
                const usersTableBody = document.querySelector('#userTable tbody');
                usersTableBody.innerHTML = ''; // Kosongkan tabel sebelum memuat data baru

                users.forEach(user => {
                    const row = usersTableBody.insertRow();
                    row.insertCell(0).textContent = user.id_part;
                    row.insertCell(1).textContent = user.description;
                    row.insertCell(2).textContent = user.specification;
                    row.insertCell(3).textContent = user.machine;
                    row.insertCell(4).textContent = user.supplier1;
                    row.insertCell(5).textContent = user.supplier2;
                    row.insertCell(6).textContent = user.location;
                    row.insertCell(7).textContent = user.type_part;
                    row.insertCell(8).textContent = user.min;
                    row.insertCell(9).textContent = user.max;
                    row.insertCell(10).textContent = user.unit;
                    row.insertCell(11).textContent = user.lt_day;
                    row.insertCell(12).textContent = user.stock;
                    row.insertCell(13).textContent = user.price;
                    row.insertCell(14).textContent = user.total_value;
                    row.insertCell(15).textContent = user.total_sparepart_cost;
                    row.insertCell(16).textContent = user.condition;
                });

                // Inisialisasi ulang DataTable setelah memuat data
                if ($.fn.DataTable.isDataTable('#userTable')) {
                    $('#userTable').DataTable().destroy(); // Hancurkan instance DataTable yang ada     
                }

                $('#userTable').DataTable({
                    responsive: true  // Menjaga agar tabel tetap responsif
                });
            }

            function fetchData(showMinData = false, filter = {}) {
                loadingSpinner.style.display = 'block';

                fetch(scriptURL)
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'success') {
                            let users = data.data;

                            if (showMinData) {
                                users = users.filter(user => user.stock < user.min);
                            }

                            // Jika ada filter, lakukan filtering
                            if (filter.column && filter.value) {
                                users = users.filter(user => {
                                    const columnValue = user[filter.column].toString().toLowerCase();
                                    return columnValue.includes(filter.value.toLowerCase());
                                });
                            }

                            displayData(users);
                        } else {
                            console.error('Error:', data.message);
                        }
                    })
                    .catch(error => console.error('Error:', error))
                    .finally(() => {
                        loadingSpinner.style.display = 'none';
                    });
            }

           // Fetch data saat halaman dimuat
           fetchData();

           // Event listener untuk tombol filter
           applyFilterButton.addEventListener('click', () => {
               const filterColumnValue = filterColumn.value;
               const filterValueText = filterValue.value;
               
               fetchData(false, { column: filterColumnValue, value: filterValueText });
           });
       });
   </script>
</body>
</html>
